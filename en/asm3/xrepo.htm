<!DOCTYPE HTML> 
<html><head><title>FreeCAD User Book - Assembly 3 - External Repositories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="USPR">
<meta name="creation-date" content="2019-11-13">
<meta name="editor" content="USPR">
<meta name="modification-date" content="2019-11-13">
<meta name="document-version" content="2">
<meta name="template-version-date" content="2019-11-17">
<link rel="stylesheet" href="../../inc/topic-1.css" />
</head><body>

<h1>The Freecad User Book</h1>
<div id="page-menu"></div>
<h1>External Repositories</h1>

<div id="navigation-panel"></div>
<div id="abstract"></div>

<h3 cbs="1">Tags</h3><div>
<p><tag>Freecad</tag>, <tag>Assembly 3</tag>, <tag>Link</tag>, <tag>External Link</tag>, <tag>Repository</tag>, <tag>External Repository</tag>, <tag>Replace With Link</tag>, <tag>Indirection</tag>, <tag>Link Layer</tag>.</p>
</div>
<h3 cbs="1">Freecad Version Info</h3><div>
<p class="code">
OS: Windows 10 (10.0)
Word size of OS: 64-bit
Word size of FreeCAD: 64-bit
Version: 0.19.17089 +1543 (Git)
Build type: Release
Branch: LinkStage3
Hash: 950c082111ae5ebeefb4dddc90a80dc9b54b2408
Python version: 3.6.8
Qt version: 5.12.1
Coin version: 4.0.0a
OCC version: 7.3.0
Locale: English/United States (en_US)
</p>
</div>
<h3 cbs="1">Files</h3><div>
<dl>
<dt id="file-001"><a href="../../files/asm3/link-1/link-011.fcstd">link-011.fcstd</a></dt><dd>Initial State File</dd>
<dt id="file-002"><a href="../../files/asm3/xrepo/xrepo-001.fcstd">xrepo-001.fcstd</a></dt><dd>Project File Example 1, Moved Components</dd>
<dt id="file-003"><a href="../../files/asm3/xrepo/xrepo-lib-001.fcstd">xrepo-lib-001.fcstd</a></dt><dd>Repository File Example 1, Moved Components</dd>
<dt id="file-004"><a href="../../files/asm3/xrepo/xrepo-002.fcstd">xrepo-002.fcstd</a></dt><dd>Project File Example 2, Extra Link Layer</dd>
<dt id="file-005"><a href="../../files/asm3/xrepo/xrepo-lib-002.fcstd">xrepo-lib-002.fcstd</a></dt><dd>Repository File Example 2, Extra Link Layer</dd>
<dt id="file-006"><a href="../../files/asm3/xrepo/xrepo-003.fcstd">xrepo-002.fcstd</a></dt><dd>Project File Example 3, Replaced Component</dd>
<dt id="file-007"><a href="../../files/asm3/xrepo/xrepo-lib-003.fcstd">xrepo-lib-002.fcstd</a></dt><dd>Repository File Example 3, Replaced Component</dd>
</dl></div>
<h3 cbs="1">Videos</h3><div>
<dl>
<dt id="vid-001"><a href="link-2-001.mp4">xrepo-001.mp4</a></dt><dd>Moving Components to an External Repository</dd>
<dt id="vid-002"><a href="link-2-002.mp4">xrepo-002.mp4</a></dt><dd>Extra Indirection Layer in the Local Repository</dd>
<dt id="vid-003"><a href="link-2-003.mp4">xrepo-002.mp4</a></dt><dd>Replacing a Component</dd>
</dl></div>

<div>
<p>In this section we will develop concepts to organize re-usable (standard) components in respositories. We already used a local repository inside the project file and links in the design to reference respository components. In these tutorials we will move standard components to an <em>external</em> repository. Such a respository can be shared among projects.

This tutorial  borders, and how components can be organized in repositories.</p>

<p>We will demonstrate how <tt>Assembly 3</tt> <tt>Links</tt> work across files, and how to repair broken links.</p>
</div>

<h2 cbs="0">Moving Components to an External Repository</h2><div>

<p>In this tutorial we will see how to move components from a project file repository in figure 25 to an external repository in figure 28. </p>

<figcaption>Figure 27: Component in a local repository</figcaption>
<img src="../../img/asm3/xrepo/fig-027.png" width="211" />

<figcaption>Figure 28: Component in an external repository</figcaption>
<img src="../../img/asm3/xrepo/fig-028.png" width="211" />

<p>With drag & drop techniques, this should be a no-brainer. Unfortunately, the current version of <tt>Assembly 3</tt> is not quite finished, and we will end up with broken links. This tutorial shows how to recover from such a situation.</p>

<h3 cbs="1">Related Files</h3><div><ul>
<li><a href="#file-001">link-011.fcstd</a>&emsp;Initial State File</li>
<li><a href="#file-002">xrepo-001.fcstd</a>&emsp;Simple links to an external repository</li>
<li><a href="#file-004">/xrepo-lib-001.fcstd</a>&emsp;Finished external repostitory for the first example.</li>
</ul></div>

<ol >
<li>Open the file <a href="#file-001">link-011.fcstd</a>.</li>
<li>Save it under the work file name "xrepo.fcstd".</li>
<li>Open the <tt>Repository</tt> node in the project file.<br /><img src="../../img/asm3/xrepo/fig-001.png" width="285" /></li>
</ol>

<p>Here are the components used in the project. The first three are standard components, washer, nut and screw. These are likely to be re-used in other projects, so it might be a good idea to store them in a separate file.</p>
 
<ol >
<li>Click the menu <tt>File > New</tt>.</li>
<li>Click the menu <tt>File > Save as...</tt> to save it under the library work file name "xrepo-lib.fcstd".</li>
</ol>

<p>We will start with the washer component <tt>Assembly000 000</tt>, and move it to the new repository file.</p>

<ol >
<li>Save the project file <tt>xrepo</tt>. When asked to save the dependency files, click <tt>Yes</tt>.</li>
<li>In the <tt>Model Tree</tt>, drag the first (next) component <tt>Assembly000 000</tt> from the local <tt>Repository</tt> folder and drop it on the external repository node <tt>xrepo-lib</tt>.<br /><img src="../../img/asm3/xrepo/fig-002.png" width="288" /></li>
<li>Right-click the project file <tt>xrepo</tt>, click <tt>Mark to recompute</tt>.</li>
<li>Click the menu <tt>Edit > Refresh</tt>. Notice that the model tree unfolds to show two elements with an error icon.<br /><img src="../../img/asm3/xrepo/fig-003.png" width="343" /></li>
<li>Notice that the washers disappeared in the 3D window.<br /><img src="../../img/asm3/xrepo/fig-004.png" width="202" /></li>
<li>Hover the mouse pointer over the broken tree nodes. An error text box appears and indicates "Link broken".</li>
<li>Inspect the <tt>Linked Object</tt> properties of these elements: They are empty&hellip;</li>
</ol>

<p>It appears that the current version of the Assembly 3 build is not yet quite finished in this area. So we will have to manually carry out the missing steps.</p>

<p>As mentioned above, the <tt>Linked Object</tt> property is empty. Fortunately, the <tt>Label</tt> value still gives a hint to what object we have to look for: <tt>Assembly000 000</tt>. This is a benefit of the strange naming convention I used for <tt>Links</tt>.</p>

<ol >
<li>Select the link node <tt>Assembly000 001</tt>.</li>
<li>Click on the value field of its property <tt>Linked Object</tt>.</li>
<li>Click on the button with the horizontal ellipsis that appears in the right corner. This opens the <tt>Link Dialog</tt>.</li>
</ol>

<p>The link dialog window shows all model nodes of a file in a simple list.</p>

<ol >
<li>Select the entry <tt>xrepo-lib</tt> into the combo box.</li>
<li>Enter "Ass" into the <tt>Search</tt> text box. This sets a filter for the listbox content, only assembly objects are listed now.</li>
<li>Select the <tt>Assembly000 000</tt> entry.<br /><img src="../../img/asm3/xrepo/fig-005.png" width="218" /></li>
<li>Click <tt>OK</tt>.</li>
</ol>

<p>The washers on the underside of the block re-appeared in the 3D window, but the node still has this error icon.</p>

<ol >
<li>Right-click the node, then click <tt>Recompute object</tt>.</li>
</ol>

<p>The error icon disappeared, the node is OK now.</p>

<ol >
<li>Repeat from step 13 for the second broken model tree node.</li>
</ol>

<p>The washers on the upperside should have reappeared.</p>

<p>To check whether there are still hidden errors in the project file you can&hellip;</p>

<ol >
<li>Collapse all nodes, right-click the project file node <tt>xrepo</tt>, and click <tt>Mark to recompute</tt>.</li>
<li>Click the menu <tt>Edit > Refresh</tt>.</li>
</ol>

<p>If nothing unfolds, the file is OK.</p>
<p>Now move the hex nut component:</p>

<ol >
<li>Repeat from step 6 with the <tt>Assembly001 000</tt>.</li>
</ol>

<p>The hex nut component should be in the external repository now.</p>

<p class="note">You can drag multiple nodes at once to the repository, but be careful not the screw up the link source fields with the wrong values.</p>

<p>The cylinder head screw will make problems. That is one of the reasons we saved the file before every transaction.</p>

<ol >
<li>Save project and repository files.</li>
<li>Drag <tt>Assembly002 000</tt> on <tt>xrepo-lib</tt>.</li>
</ol>

<p>Note that not only the <tt>Assembly</tt> node was moved, but also some additional nodes: XY_Plane003 and Pad005, and Sketch006.</p>

<img src="../../img/asm3/xrepo/fig-009.png" width="242" />

<p>This indicates to an experienced user that <tt>Assembly002 000</tt> has dependencies in the additional nodes. It is not quite easy to find them, but <tt>Pad005</tt> in the 3D window looks like our <tt>Block</tt> component:</p>

<img src="../../img/asm3/xrepo/fig-010.png" width="242" />

<p>The following recipe shows a method to find the element(s) that causes problems:</p>

<ol >
<li>Delete <tt>Pad005</tt> (and optionally <tt>Sketch006</tt> and <tt>XY_Plane003</tt>) in the repository file.</li>
<li>Ignore the warning and click <tt>Yes</tt> to continue.</li>
</ol>

<p>The tree unfolds and exposes a node with an error icon, <tt>Pad003</tt></p>

<img src="../../img/asm3/xrepo/fig-011.png" width="261" />

<ol >
<li>Select <tt>Pad003</tt>.</li>
<li>Carefully browse through the properties.</li>
</ol>

<p>The <tt>Length</tt> property deserves your attention: The value is a formula, and the expression references <tt>Pad005.Length</tt>. This is the thickness of our <tt>Block</tt> component! The thickness determines the lenght of the thread.</p>

<img src="../../img/asm3/xrepo/fig-012.png" width="264" />

<p>It appears that the screw is not really a standard component&hellip;</p>

<p>We have now three choices:</p>

<ul>
<li>Revert the files, leave the screw in the local repository, and update the description.</li>
<li>Undo the last two steps.</li>
<li>Replace the formula in the thread lenght property with a constant value.</li>
</ul>

<p>I have seen Undo to fail in this context, at least in the current version of <tt>Assembly 3</tt>, so reverting to the last stored file version seems to be the better option.</p>

<p>The third option will be chosen in the next tutorial, so we'll go for the second option, revert the files.</p>

<ol >
<li>Select the repository file.</li>
<li>Click the menu <tt>File > Revert</tt>. Accept the warning.</li>
<li>Select the project file.</li>
<li>Click the menu <tt>File > Revert</tt>. Accept the warning.</li>
<li>Change the screw description to "CHS M8 for Block Fasteners".</li>
</ol>

<p>Cleanup:</p>

<ol >
<li>Collapse all nodes.</li>
<li>Save the project file under the name "xrepo-001.fcstd".</li>
<li>Save the repsitory file under the name "xrepo-lib-001.fcstd".</li>
</ol>

<h3>Conclusion</h3><div>

<p>The steps to repair the broken links are relatively simple. The specific naming convention helps to identify the missing link source object.</p>

<!-- h3 Conclusion --></div>

<!-- h2 Moving Components to an External Repository --></div>

<h2 cbs="0">Component Link Layer</h2><div>

<p>An interesting concept to work with standard components is to use <tt>Links</tt> to a <tt>Link</tt> that links to a component:</p>

<img src="../../img/asm3/xrepo/fig-024.png" width="211" />

<p>The component may be stored in the local repository in the project file initially. When matured, the component can be moved to an external repository:</p>

<img src="../../img/asm3/xrepo/fig-025.png" width="211" />

<p>When used early in the project, this concept can save a lot of work. And as an added bonus, it is quite easy to work with variants:</p>

<img src="../../img/asm3/xrepo/fig-026.png" width="211" />

<p>Only the local repository link has to be modified to point to the new component, all dependent links will inherit the change automatically.</p>

<p>This additional link layer can be created easily with the <tt>Assembly 3</tt> <tt>Replace With Link</tt> function.</p>

<h3 cbs="1">Related Files</h3><div><ul>
<li><a href="#file-001">link-011.fcstd</a>&emsp;Initial State File</li>
<li><a href="#file-002">xrepo-002.fcstd</a>&emsp;Finished project file for the second example</li>
<li><a href="#file-005">xrepo-lib-002.fcstd</a>&emsp;Finished external repostitory for the second example</li>
</ul></div>

<ol start="1">
<li>Open the file <a href="#file-001">link-011.fcstd</a>.</li>
<li>Save it under the work file name "xrepo.fcstd".</li>
<li>Open the <tt>Repository</tt> node in the project file. The first three nodes are the standard components that will be moved to an external repository.<br /><img src="../../img/asm3/xrepo/fig-001.png" width="285" /></li>
<li>Click the menu <tt>File > New</tt>.</li>
<li>Click the menu <tt>File > Save as&hellip;</tt>.</li>
<li>Save the new file under the work file name "xrepo-lib.fcstd".</li>
</ol>

<div class="note"><p>Note that you <em>must save</em> an external repository file before a link into the file can be created, because the file name is part of the link information.</p></div>

<p>Now we will replace the first repository component with a <tt>Link</tt>:</p>

<ol >
<li>Right-click the washer node, click <tt>Link actions > Replace with link</tt>.<br /><img src="../../img/asm3/xrepo/fig-006.png" width="285" /></li>
</ol>

<p>The component in the repository has been replaced by the link node <tt>Assembly000 003</tt>, and the component has moved down near the end of the model tree.
</p>

<ol >
<li>Make sure to have hidden properties visible: Right-click on the <tt>Property Panel</tt>, click <tt>Select all</tt>.</li>
<li>Copy the <tt>Label2</tt> value from <tt>Assembly000 000</tt> to <tt>Assembly000 003</tt>.</li>
<li>Hide the link object <tt>Assembly000 003</tt>.</li>
<li>Drag the component <tt>Assembly006 000</tt> to the external repository node <tt>xrepo-lib</tt>.</li>
</ol>

<p>Everything looks fine, but&hellip;</p>

<ol >
<li>Right-click the <tt>Repository</tt> node, click <tt>Recompute object</tt>.</li>
</ol>

<p>The model tree unfolds and reveals three nodes with problems:</p>

<img src="../../img/asm3/xrepo/fig-007.png" width="372" />

<p>Fortunately, we already know how to deal with that:</p>

<ol >
<li>Select the first (next) problem node in the model tree.</li>
<li>Click the <tt>Linked Object</tt> property value area.</li>
<li>Click the button with the &hellip; at the right side to open the <tt>Link</tt> editor window.<br /><img src="../../img/asm3/xrepo/fig-005.png" width="219" /></li>
<li>Select <tt>xrepo-lib</tt> into the combobox.</li>
<li>Enter <kbd>ass</kbd> into the <tt>Search</tt> filter textbox.</li>
<li>Select the <tt>Assmebly000 000</tt> in the listbox.</li>
<li>Click <tt>OK</tt>.</li>
</ol>

<p>That repaired the link to the external component.</p>

<p>The remaining two problem nodes are treated similarly, except that their link source object <tt>Assembly000 003</tt> is found in the local repository:</p>

<img src="../../img/asm3/xrepo/fig-008.png" width="219" />

<p class="tip">Note that new objects always seem to appear at the end of the list, so you don't always have to set a search filter.</p>

<p>To verify that there are no more problems with the file, &hellip;</p>

<ol >
<li>Collapse all expanded nodes.</li>
<li>Right-click on the project file node, then click <tt>Mark for recompute</tt>.</li>
<li>Click the menu <tt>Edit > Refresh</tt>.</li>
</ol>

<p>If the project file is OK, no new problem nodes are unfolded.</p>

<ol >
<li>Click the menu <tt>File > Save</tt> to save the working copy of the project file.</li>
<li>When asked to save the dependency files, click <tt>Yes</tt>.</li>
<li>Repeat from step 7 with the second standard component, the hex nut <tt>Assembly001 000</tt>.</li>
</ol>

<p>As we have learned from the previous exercise, the cylinder head screw <tt>Assembly002 000</tt> causes problems because of a reference to <tt>Pad005.Length</tt> in the <tt>Pad003.Length</tt> value.</p>

<ol >
<li>Select the node <tt>Assembly002 000 > Parts002 > Body002 > Pad003</tt>.</li>
<li>Discard the formula in the <tt>Length</tt> property, and set it to a fixed value of "35 mm".</li>
<li>Collapse <tt>Assembly002 000</tt>.</li>
</ol>

<p>Now the component is prepared to be moved to the external repository</p>

<ol >
<li>Repeat from step 7 for <tt>Assembly002 000</tt>.</li>
</ol>

<p>Final cleanup:</p>

<ol >
<li>Collapse all nodes.</li>
<li>Save a copy of the project file under the name "xrepo-002.fcstd".</li>
<li>Save a copy of the repository file under the name "xrepo-lib-002.fcstd".</li>
</ol>

<h3>Conclusion</h3><div>

<p>As we have seen in this example, the function <tt>Replace With Link</tt> creates an indirection layer for a component. Now the component can be moved, or even exchanged with a different component. This will be explored in the next example.</p>

<!-- h3 Conclusion --></div>
<!-- h2 Component Link Layer --></div>

<h2 cbs="0">Replacing a Component</h2><div>

<p><tt>Assembly 3</tt> <tt>Link</tt> objects make it easy to replace one component with  another in the entire project, without breaking the project model. The only requirement is that both components, old and new, have the same public constraint connector names.</p>

<p>In this example, we will replace the cylinder head screw with a hexagon head screw.</p>

<img src="../../img/asm3/xrepo/fig-025.png" width="211" />

<p>We will create a new compontent in the external repository, and modify the link in the local repository to point to the new component.</p>

<img src="../../img/asm3/xrepo/fig-026.png" width="211" />

<h3 cbs="1">Related Files</h3><div><ul>
<li><a href="#vid-003">xrepo-002.mp4</a>&emsp;Replacing a Component</li>
<li><a href="#file-004">xrepo-002.fcstd</a>&emsp;Project File Example 2, Extra Link Layer</li>
<li><a href="#file-005">xrepo-lib-002.fcstd</a>&emsp;Repository File Example 2, Extra Link Layer</li>
<li><a href="#file-006">xrepo-003.fcstd</a>&emsp;Project File Example 3, Replaced Component</li>
<li><a href="file-007">xrepo-lib-003.fcstd</a>&emsp;Repository File Example 3, Replaced Component</li>
</ul></div>

<p>Step 1: Load the initial state files, and rename them to obtain the work files.</p>

<ol start="1">
<li>Load the file <a href="#file-004">xrepo-002.fcstd</a>.</li>
<li>Save the project file under the name "xrepo.fcsdt".</li>
<li>Close the repository file <tt>xrepo-lib</tt>.</li>
<li>Open the file <a href="#file-005">xrepo-lib-002.fcstd</a>.</li>
<li>Save the repository file under the name "xrepo-lib.std"</li>
</ol>

<p>We will now create a second screw in the respository file.</p>

<ol >
<li>Switch to the <tt>Part Design</tt> workbench.</li>
<li>Select the repository file node.</li>
<li>Create a new <tt>Body</tt>.</li>
<li>Create a new <tt>Sketch</tt> on the XY plane.</li>
<li>Create a circle on the sketch origin.</li>
<li>Constrain the diameter to "8 mm".</li>
<li>Close the sketch.</li>
<li>Create a new <tt>Pad</tt> with a length of 10 mm, reversed.</li>
<li>Set <tt>Label2</tt> to "Shaft".</li>
<li>Select the underside of the Pad in the 3D window.</li>
<li>Create a new Sketch.</li>
<li>Click the menu <tt>Sketch > Geometries > External geometry > Defining</tt></li>
<li>Close the sketch.</li>
<li>Create a new <tt>Pad</tt> with a length of 30 mm.</li>
<li>Set <tt>Label2</tt> to "Thread".</li>
<li>Select to lower edge of the thread.</li>
<li>Create a new <tt>Chamfer</tt> with a width of 1.2 mm.</li>
<li>Create a new <tt>Sketch</tt> on the XY plane.</li>
<li>Create a hexagon on the sketch origin.</li>
<li>Set the distance between two parallel lines to 13 mm.</li>
<li>Close the sketch.</li>
<li>Create a new <tt>Pad</tt>, length 6.4 mm.</li>
<li>Set <tt>Label2</tt> of the pad to "Head".</li>
</ol>

<img src="../../img/asm3/xrepo/fig-015.png" width="103" />

<p>Wrap the new Body with an Assembly object:</p>

<ol >
<li>Select the repository file <tt>xrepo-lib</tt>.</li>
<li>Switch to the <tt>Assembly3</tt> workbench.</li>
<li>Create a new <tt>Assembly</tt> element.</li>
<li>Set <tt>Label</tt> to "Assembly003 000".</li>
<li>Set <tt>Label2</tt> to "HHN M8x35"</li>
<li>Drag <tt>Body003</tt> on <tt>Assembly003 000</tt>.</li>
</ol>

<img src="../../img/asm3/xrepo/fig-016.png" width="252" />

<p>Create the constraint connector:</p>

<ol >
<li>Set <tt>Label2</tt> of <tt>Elements003</tt> to "Constraint Connectors".</li>
<li>Select the edge between shaft and head in the 3D window.</li>
<li>Drag the associated <tt>Pad007</tt> on the <tt>Constraint Connectors</tt> node.</li>
<li>Set <tt>Label2</tt> of the new connector to "Head Seat".</li>
</ol>

<p>To make the new screw compatible with the old one, the public constraint connectors must have the same label name:</p>

<ol >
<li>Select the <tt>Head Seat</tt> constraint connector of the cylinder head screw.</li>
<li>Copy the <tt>Label</tt> property value.</li>
<li>Select the <tt>Head Seat</tt> constraint connector of the hexagon head screw.</li>
<li>Paste the <tt>Label</tt> property value.</li>
</ol>

<img src="../../img/asm3/xrepo/fig-017.png" width="270" />

<p>The connector in the 3D window:</p>

<img src="../../img/asm3/xrepo/fig-018.png" width="126" />

<p>Obviously, it is possible to have duplicate <tt>Element</tt> label names!</p>

<p class="note">NOTE that the internal name of the node ("Element005") now differs from the label value ("Element004"). Make sure that this is not a source of confusion!</p>

<p>Final cleanup steps:</p>

<ol >
<li>Collapse all open nodes.</li>
<li>Hide <tt>Assembly003 000</tt>.</li>
<li>Save a copy of the repository file under the name "asm2-link-2-lib-003.fcstd".</li>
</ol>

<p>The repository is ready. Now we can exchange the screw in the project file.</p>

<div class="note">
<p>Why not copy the cylinder head screw?</p>
<p>In the current preview version of <tt>Assembly 3</tt>, the copy function is not always reliable, and sometimes produces access violations, sometimes the copy dialog looks different. It is not clear whether the model structure is damaged, or not, so we will opt for the safe road.</p>
</div>

<ol >
<li>Open the <tt>Repository</tt> node in the project file.</li>
<li>Select the screw component <tt>Assembly002 000</tt>.</li>
<li>Click on the value field of the <tt>Linked Object</tt> property.</li>
<li>Click the button with the horizontal ellipsis to open the <tt>Link</tt> editor dialog.</li>
<li>Make sure the repository file is selected in the combobox.</li>
<li>Set the <tt>Search</tt> filter to "***". (Censored)</li>
<li>Select the <tt>Assembly003 000</tt> entry.</li>
<li>Click <tt>OK</tt>.<br />Et voilá &mdash; we have four new bolts in the project assembly!<br /><img src="../../img/asm3/xrepo/fig-019.png" width="235" /></li>
<li>Copy the <tt>Label2</tt> value from the repository component.</li>
</ol>

<p>Now we will verify that the constraints in the project are still operational.</p>

<ol >
<li>Switch to the <tt>Assembly 3</tt> workbench.</li>
<li>Open the <tt>Block</tt> assembly node in the local <tt>Repository</tt> folder.</li>
<li>Drill down to the <tt>Sketch006</tt> node.</li>
<li>Expand the <tt>Constraints</tt> property.</li>
<li>Change the <tt>L2</tt> value to "20 mm".<br />The fastener position should have changed.</li>
<li>If not, execute the menu <tt>Assembly3 > Solve constraints.</tt></li>
</ol>

<p>Now the fasteners should have moved:</p>

<img src="../../img/asm3/xrepo/fig-020.png" width="224" />

<h3>Conclusion</h3><div>

<p>Instead of directly linking to repository components, an additional link layer in the local project repository opens an option to exchange components with other, compatible versions. To help migrating components, the <tt>Replace with link</tt> function was used. However, the the function is not yet perfect, some manual actions have to be carried out to fix broken links in the project.</p>

<!-- h3 --></div>
<!-- h2 Replacing a Component --></div>

<h2 cbs="0">Repository File Renamed or Moved</h2><div>

<p>Repository files should never be renamed or moved. Such an operation breaks existing projects that depend on shared libraries. Unfortunately, reality is different. Servers go out of service, storage structures will be reorganized, project move to different computers.</p>

<p>The following tutorial deals with such a situation.</p>

<ol start="1">
<li>Close all files in Freecad.</li>
<li>Rename the respository "xrepo-lib.fcstd".</li>
<li>Open the project file "xrepo.fcstd" in Freecad.</li>
<li>Notice the broken links in the local <tt>Repository</tt>.<br /><img src="../../img/asm3/xrepo/fig-021.png" width="289" /></li>
</ol>

<p>Fortunately, the <tt>Linked Object</tt> propety now carries a detailed error message:</p>

<img src="../../img/asm3/xrepo/fig-022.png" width="256" />

<p>So we can search for the repository file, and load it manually:</p>

<ol >
<li>Open the renamed resository file.</li>
</ol>

<p>Now we can reassign the broken <tt>Linked Object</tt> fields. The error info specifies the name of the linked object, but this is the internal name, not the searchable <tt>Label</tt> value. Fortunately, our naming convention gives the hint to name to search for.</p>

<ol >
<li>Select the node <tt>Assembly000 003</tt> in the project file.</li>
<li>Click on the value field of the <tt>Linked Object</tt> property.</li>
<li>Click on the horizontal ellipsis button to open the <tt>Link</tt> editor dialog.</li>
<li>Select the repository file in the combobox.</li>
<li>Enter the first part of the <tt>Label</tt> value (<tt>Assembly000</tt>) into the Search filter box.</li>
<li>Select the matching entry in the listbox.</li>
<li>Click <tt>OK.</tt><br /><img src="../../img/asm3/xrepo/fig-023.png" width="219" /></li>
</ol>

<p>The missing washer component re-appears in the 3D window.</p>

<ol >
<li>Repeat from step 6 for the other broken links.</li>
<li>When done, right-click the project file node, then click <tt>Mark for recompute</tt>.</li>
<li>Click the menu <tt>Edit > Refresh</tt>.</li>
</ol>

<p>All broken links should have been repaired now.</p>

<h3>Conclusion</h3><div>

<p>Situations like these are another strong argument for an external components link layer in the local repository of a project file. This limits the number of broken links to the number of different components used from the repository.</p>

<p>If you linked directly to external components throughout the entire project file (the "quick & dirty" method...), the number of broken links would <em>equal the total number of links to external components</em> (in that repository).</p>

<!-- h3 --></div>

<!-- h2 Repository File Renamed or Moved --></div>

<h2 cbs="0">Partial Loading</h2><div>

<p>If you open a project that contains links to an external repository, the repository is also opened, but only the linked parts are loaded into memory. This space-saver allows you to work with very large libraries with a lot of "unused" parts inside, without having to worry about memory constraints.</p>

<p>If you explicitly open the repository, the entire library is loaded into memory. This allows to add links to other parts in the repository to the project.</p>

<p>If you close a repository file, the linked parts disappear from the 3D view. If you re-open the repository, the parts reappear.</p>

<p>If you open a different repository with the same parts but different implementations, these alternative parts appear in the project. This allows you to swap one repository file for another with different part implementations. The only requirement is that the internal names and the <tt>Connector</tt> names of objects are the identical in both repositories.</p>

<!-- h2 <Partial Loading --></div>

<h2 id="xrepo-workflow" cbs="0">External Repository Workflow</h2><div>

<p>In this section we will explore the recommended workflow with external repositories, and the effect of the object naming convention.</p>

<h4 cbs="1">Files</h4><div><dl>
<dt><a href="../../files/asm3/xrepo/xrepo-workflow-001.fcstd">xrepo-workflow-001.fcstd</a></dt><dd>Project workfile with repository folers.</dd>
<dt><a href="../../files/asm3/xrepo/xrepo-workflow-002.fcstd">xrepo-workflow-002.fcstd</a></dt><dd>Project with linked components.</dd>
<dt><a href="../../files/asm3/xrepo/xrepo-workflow-lib-001.fcstd">xrepo-workflow-lib-001.fcstd</a></dt><dd>Repository file with sample components.</dd>
</dl></div>

<p>As always, we begin with setting up the work files.</p>

<ol start="1">
<li>Create a new project file.</li>
<li>Save it under the name "xrepo-workflow.fcstd".</li>
<li>Create a new <tt>Group</tt> node and name it "Imported Components".</li>
<li>Create a new <tt>Group</tt> node and name it "Project Repository".</li>
<li>Save a copy of the workfile under the name "xrepo-workflow-001.fcstd".</li>
<li>Open the file <a href="../../files/asm3/xrepo/xrepo-workflow-lib-001.fcstd">xrepo-workflow-lib-001.fcstd</a>.</li>
<li>Save it under the work file name "xrepo-workflow-lib.fcstd".<br />This is our component repository.</li>
</ol>

<p>Have a look at the component names (the <tt>Label</tt> property) in the repository.</p>

<img src="../../img/asm3/xrepo/fig-033.png" width="175" />

<p>I used a key string that identifes the component and its main characteristics: A washer, a hex nut and a cylinder head screw. The composition of such a key string is usually company-specific, but there should be rules for naming standard components.</p>

<p>The other rule I recommend to follow here is the postfix " 000": This stands for the <em>definition of a component</em>.</p>

<p>The description string (in the <tt>Label2</tt> property) was left empty, you can add additional information here that might be useful for selecting a component. Note that this information is not usually copied when a <tt>Link</tt> is created from a component definition.</p>

<p>In a project file, the <tt>Description</tt> should contain information about the purpose of a component in the design.</p>

<p>In the next step we will create links to some of the components and import them into the project:</p>

<ol>
<li>Select all three components in the <tt>xrepo-workflow-lib</tt>.</li>
<li>Right-click on the selection, then click <tt>Link actions > Make link</tt>.<br /><img src="../../img/asm3/xrepo/fig-034.png" width="180" />
</li>
</ol>

<p>Three component <tt>Links</tt> are added to the repository file. Now we will move them to the local repository in the project file.</p>

<ol>
<li>Drag the selected <tt>Link</tt> objects in the repository on the project file node <tt>xrepo-workflow</tt>.<br />The <tt>Links</tt> moved to the bottom of the project file. They are still selected.</li>
<li>Drag the selection on the <tt>Project Repository</tt> node.<br /><img src="../../img/asm3/xrepo/fig-035.png" width="172" /></li>
<li>Drag the selection on the <tt>Project Repository</tt> node.<br /><img src="../../img/asm3/xrepo/fig-036.png" width="175" /></li>
</ol>

<p>Currently it is not possible to drag the link objects from the repository and drop them directly on the group node.</p>

<p>Note the node names: The instance counter has been incremented to "001". In our naming convention this means that the node is a member of the indirection layer, and not to be used directly in the construction. The next steps demonstrate how to use them in the <tt>Project Assembly Container</tt>:</p>

<ol>
<li>Switch to the <tt>Assembly 3</tt> workbench.</li>
<li>Create a new <tt>Assembly</tt>.</li>
<li>Rename it to "Project Assembly Container".</li>
<li>Select the three components in the <tt>Project Repository</tt>.</li>
<li>Right-click on the selection, then click <tt>Link actions > Make link</tt>.</li>
<li>Drag the new links on the <tt>Project Assembly Container</tt>.<br /><img src="../../img/asm3/xrepo/fig-037.png" width="200" /></li>
</ol>

<p>Note the instance numbers. A value greater than one indicates a component used in the construction. The workflow implements the scheme illustrated in figure 25:</p>

<img src="../../img/asm3/xrepo/fig-025.png" width="211" />

<p>The following table summarizes this relationship:</p>

<style>#table-001 tr td:first-child { text-align: center; }</style>
<table id="table-001" class="flat-borders"><thead><tr>
	<th>Index</th>
	<th>Usage</th>
</tr></thead><tbody><tr>
	<td>000</td>
	<td>Component Definition</td>
</tr><tr>
	<td>001</td>
	<td>Link layer in local repository</td>
</tr><tr>
	<td>002</td>
	<td rowspan="2">Component links used in the project</td>
</tr><tr>
	<td>&hellip;</td>
</tr></tbody></table>

<p>The naming scheme offers the following benefits:</p>

<ul>
<li>Components can be exchanged on the project level by changing the 001 link in the indirection layer.</li>
<li>Broken links can be repaired by searching for the component with the same key string and the index 000.</li>
<li>External repository components can easily be imported (into the dedicated folder) to create a self-contained project file.</li>
</ul>

<p>Final project file cleanup:</p>

<ol>
<li>Collapse all nodes.</li>
<li>Save a copy of the project file under the name "xrepo-workflow-002.fcstd".</li>
</ol>

<p>The repository file was not changed, so we don't need to save it.</p>

<!-- h2 Working With External Repositories --></div>

<h2 id="import-links" cbs="0">Import Links</h2><div>

<p>There are situations where you want to move components from an external repository into the project file, for example to hand out the entire project so someone else in a single file.</p>

<p>This can be done with the <tt>Import Link</tt> command. The workflow is as follows:</p>

<ol start="1">
<li>Open the file <a href="../../files/asm3/xrepo/xrepo-003.fcstd">xrepo-003.fcstd</a>.</li>
<li>Save it under the work file name "import-link.fcstd".</li>
<li>Open the <tt>Repository</tt> folder.</li>
<li>Identify the external <tt>Link</tt> elements. They have a link icon in the lower left corner, and a chevron in the lower right corner.<br /><img src="../../img/asm3/xrepo/fig-029.png" width="90" /><br />You should be able to find three components:<br /><img src="../../img/asm3/xrepo/fig-030.png" width="262" /></li>
<li>Select the identified components.</li>
<li>Right-click on the selection, then click <tt>Import links</tt>.<br />Three new components were added to the project file.<br /><img src="../../img/asm3/xrepo/fig-031.png" width="287" /></li>
<li>Drag them to the <tt>Repository</tt>.<br /><img src="../../img/asm3/xrepo/fig-032.png" width="283" /></li>
</ol>

<p>Note that their <tt>Label</tt> Names have not changed, and even the <tt>Description</tt> fields were copied from the external repository components.</p>

<p>Note that we now have the component definition (Assembly999 000) and the component indirection layer (Assembly999 009) in the repository. If we </p>

<!-- h2 Import Links --></div>

<div id="script-area">
<script src="../../inc/topic-1.js"></script>
<script>
// Request document resources.
Synesis.Loader.request ( {
	uriPrefix: "../" ,
	uris : "table-of-contents.htm" ,
	targetContainers : "navigation-panel" ,
	successHandlers : [ Synesis.Loader.prefixLinks, Synesis.Loader.integrateResponseHtml ], 
	finishedHandlers : [ Synesis.CollapsibleBlock.initDocument, Synesis.CollapsibleTree.initDocument, Synesis.NavigationTree.initDocument, Synesis.Navigation.initDocument, Synesis.OrderedList.initStartAttributes ]
} ) ;
</script>

</div></body></html>